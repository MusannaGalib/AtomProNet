#!/bin/bash

#Bash script for hydrostatic strain
#for every strain in x direction, y strains in y direction 
#Put your INCAR, POTCAR, KPOINTS, Submission file in the same folder with 2D_strain.sh
#use fractional coordinate in the POSCAR file to apply strains on atoms defined in terms of lattice vector
#run this file

EXX=0      #e1 strain
EYY=0      #e2 strain
EZZ=0      #e3 strain
EYZ=0      #ezy or eyz or e4 strain
EXZ=0      #exz or ezx or e5 strain
EXY=0      #exy or eyx or e6 strain


A=(9.6084604233904560    0.0000000000000000   -0.0000000000000000)  #1st lattice vector
B=(0.0000000000000000    9.8815205321544433    0.0000000000000000)  #2nd lattice vector
C=(0.0000000000000000    0.0000000000000000    7.0229793718520046)  #3rd lattice vector

# Initialize counter
counter=0


# Strain range in XX direction
for EXX in $(seq -0.2 0.0001 0.2)
do 
((counter++))
mkdir strain_XX_$EXX
cd strain_XX_$EXX 
  # Strain range in YY direction  
  mkdir strain_YY_$EXX
  cd strain_YY_$EXX  
  # Strain range in ZZ direction 
  EYY=$EXX
  EZZ=$EXX
  echo "Debug: Simulation $counter - EXX=$EXX, EYY=$EYY, EZZ=$EZZ"   
cat <<EOF >POSCAR
   Al  O                                      
1.0000000000000000
$(echo "(${A[0]}*(1+$EXX))+(${A[1]}*($EXY/2))+(${A[2]}*($EXZ/2))" | bc)   $(echo "(${A[0]}*($EXY/2))+(${A[1]}*(1+$EYY))+(${A[2]}*($EYZ/2))" | bc)    $(echo "(${A[0]}*($EXZ/2))+(${A[1]}*($EYZ/2))+(${A[2]}*(1+$EZZ))" | bc)               
$(echo "(${B[0]}*(1+$EXX))+(${B[1]}*($EXY/2))+(${B[2]}*($EXZ/2))" | bc)   $(echo "(${B[0]}*($EXY/2))+(${B[1]}*(1+$EYY))+(${B[2]}*($EYZ/2))" | bc)    $(echo "(${B[0]}*($EXZ/2))+(${B[1]}*($EYZ/2))+(${B[2]}*(1+$EZZ))" | bc)                             
$(echo "(${C[0]}*(1+$EXX))+(${C[1]}*($EXY/2))+(${C[2]}*($EXZ/2))" | bc)   $(echo "(${C[0]}*($EXY/2))+(${C[1]}*(1+$EYY))+(${C[2]}*($EYZ/2))" | bc)    $(echo "(${C[0]}*($EXZ/2))+(${C[1]}*($EYZ/2))+(${C[2]}*(1+$EZZ))" | bc)                                                                                  
   Al   O 
    32    48
Selective dynamics
Direct
  0.1261505048008345  0.0156972163902792  0.3899883679678432   T   T   T
  0.1261505048008345  0.5156972275961564  0.3899883679678432   T   T   T
  0.6261505196553273  0.0156972163902792  0.3899883679678432   T   T   T
  0.6261505196553273  0.5156972275961564  0.3899883679678432   T   T   T
  0.1261505048008345  0.2343027873407949  0.6100116022350142   T   T   T
  0.1261505048008345  0.7343027724417865  0.6100116022350142   T   T   T
  0.6261505196553273  0.2343027873407949  0.6100116022350142   T   T   T
  0.6261505196553273  0.7343027724417865  0.6100116022350142   T   T   T
  0.1238494952381885  0.2656972276088040  0.1100116097305722   T   T   T
  0.1238494952381885  0.7656972275835088  0.1100116097305722   T   T   T
  0.6238494803316627  0.2656972276088040  0.1100116097305722   T   T   T
  0.6238494803316627  0.7656972275835088  0.1100116097305722   T   T   T
  0.1238494952381885  0.4843027723532530  0.8899883977721055   T   T   T
  0.1238494952381885  0.9843027724291389  0.8899883977721055   T   T   T
  0.6238494803316627  0.4843027723532530  0.8899883977721055   T   T   T
  0.6238494803316627  0.9843027724291389  0.8899883977721055   T   T   T
  0.3738494802926468  0.4843027723532530  0.6100116022350142   T   T   T
  0.3738494802926468  0.9843027724291389  0.6100116022350142   T   T   T
  0.8738494802666267  0.4843027723532530  0.6100116022350142   T   T   T
  0.8738494802666267  0.9843027724291389  0.6100116022350142   T   T   T
  0.3738494802926468  0.2656972276088040  0.3899883679678432   T   T   T
  0.3738494802926468  0.7656972275835088  0.3899883679678432   T   T   T
  0.8738494802666267  0.2656972276088040  0.3899883679678432   T   T   T
  0.8738494802666267  0.7656972275835088  0.3899883679678432   T   T   T
  0.3761505197203632  0.2343027873407949  0.8899883977721055   T   T   T
  0.3761505197203632  0.7343027724417865  0.8899883977721055   T   T   T
  0.8761505196943503  0.2343027873407949  0.8899883977721055   T   T   T
  0.8761505196943503  0.7343027724417865  0.8899883977721055   T   T   T
  0.3761505197203632  0.0156972163902792  0.1100116097305722   T   T   T
  0.3761505197203632  0.5156972275961564  0.1100116097305722   T   T   T
  0.8761505196943503  0.0156972163902792  0.1100116097305722   T   T   T
  0.8761505196943503  0.5156972275961564  0.1100116097305722   T   T   T
  0.0535362653381393  0.0511954994940201  0.6541485612602712   T   T   T
  0.0535362653381393  0.5511955293173247  0.6541485612602712   T   T   T
  0.5535362430433972  0.0511954994940201  0.6541485612602712   T   T   T
  0.5535362430433972  0.5511955293173247  0.6541485612602712   T   T   T
  0.0535362653381393  0.1988045004933323  0.3458514685938142   T   T   T
  0.0535362653381393  0.6988044707206182  0.3458514685938142   T   T   T
  0.5535362430433972  0.1988045004933323  0.3458514685938142   T   T   T
  0.5535362430433972  0.6988044707206182  0.3458514685938142   T   T   T
  0.1964637272086013  0.3011954994813725  0.8458514387468413   T   T   T
  0.1964637272086013  0.8011955293046771  0.8458514387468413   T   T   T
  0.6964636974215770  0.3011954994813725  0.8458514387468413   T   T   T
  0.6964636974215770  0.8011955293046771  0.8458514387468413   T   T   T
  0.1964637272086013  0.4488045004806845  0.1541485165076110   T   T   T
  0.1964637272086013  0.9488044707079706  0.1541485165076110   T   T   T
  0.6964636974215770  0.4488045004806845  0.1541485165076110   T   T   T
  0.6964636974215770  0.9488044707079706  0.1541485165076110   T   T   T
  0.4464637570086287  0.4488045004806845  0.3458514685938142   T   T   T
  0.4464637570086287  0.9488044707079706  0.3458514685938142   T   T   T
  0.9464637569826158  0.4488045004806845  0.3458514685938142   T   T   T
  0.9464637569826158  0.9488044707079706  0.3458514685938142   T   T   T
  0.4464637570086287  0.3011954994813725  0.6541485612602712   T   T   T
  0.4464637570086287  0.8011955293046771  0.6541485612602712   T   T   T
  0.9464637569826158  0.3011954994813725  0.6541485612602712   T   T   T
  0.9464637569826158  0.8011955293046771  0.6541485612602712   T   T   T
  0.3035362430043742  0.1988045004933323  0.1541485165076110   T   T   T
  0.3035362430043742  0.6988044707206182  0.1541485165076110   T   T   T
  0.8035362429783612  0.1988045004933323  0.1541485165076110   T   T   T
  0.8035362429783612  0.6988044707206182  0.1541485165076110   T   T   T
  0.3035362430043742  0.0511954994940201  0.8458514387468413   T   T   T
  0.3035362430043742  0.5511955293173247  0.8458514387468413   T   T   T
  0.8035362429783612  0.0511954994940201  0.8458514387468413   T   T   T
  0.8035362429783612  0.5511955293173247  0.8458514387468413   T   T   T
  0.0250940235969028  0.1250000000442668 -0.0000000000000000   T   T   T
  0.0250940235969028  0.6250000000189715 -0.0000000000000000   T   T   T
  0.5250940496898227  0.1250000000442668 -0.0000000000000000   T   T   T
  0.5250940496898227  0.6250000000189715 -0.0000000000000000   T   T   T
  0.2249059800841988  0.3750000000316192  0.5000000000498304   T   T   T
  0.2249059800841988  0.8750000000063238  0.5000000000498304   T   T   T
  0.7249060099232492  0.3750000000316192  0.5000000000498304   T   T   T
  0.7249060099232492  0.8750000000063238  0.5000000000498304   T   T   T
  0.4749059502581515  0.3750000000316192 -0.0000000000000000   T   T   T
  0.4749059502581515  0.8750000000063238 -0.0000000000000000   T   T   T
  0.9749059502321384  0.3750000000316192 -0.0000000000000000   T   T   T
  0.9749059502321384  0.8750000000063238 -0.0000000000000000   T   T   T
  0.2750940497548586  0.1250000000442668  0.5000000000498304   T   T   T
  0.2750940497548586  0.6250000000189715  0.5000000000498304   T   T   T
  0.7750940497288386  0.1250000000442668  0.5000000000498304   T   T   T
  0.7750940497288386  0.6250000000189715  0.5000000000498304   T   T   T
EOF
	mkdir strain_ZZ_$EXX
	cp ../../INCAR strain_ZZ_$EXX/
	cp POSCAR strain_ZZ_$EXX/
	cp ../../POTCAR strain_ZZ_$EXX/
	cp ../../KPOINTS strain_ZZ_$EXX/
	cp ../../vasp_job.sh strain_ZZ_$EXX/
	cd strain_ZZ_$EXX

	#submission
	#qsub VASP_JobSub.sh
	# post process 
	#E=`grep 'F' OSZICAR|tail -n 1 | awk '{ print $5}'`;
	#echo $EXX $E >>../pos-conv.txt
	cd ../
	
  cd ../	
  	
cd ..
done


#Crystal lattice vectors (in cartesian axis):     x or a  y or b  z or c
 #1st lattice vector   a(1)    a(2)   a(3)
 #2nd lattice vector   b(1)    b(2)   b(3)
 #3rd lattice vector   c(1)    c(2)   c(3)
#Hexagonal --- celldm(3)=c/ l_c
#a = l_c*(1,0,0),  b =  l_c*(-1/2,sqrt(3)/2,0),  c =  l_c*(0,0,c/l_c)
# The strain tensor ϵ is defined by
#  ϵ = [ ϵ1      ϵ6/2   ϵ5/2    
#        ϵ6/2    ϵ2     ϵ4/2     
#        ϵ5/2    ϵ4/2   ϵ3 ]


